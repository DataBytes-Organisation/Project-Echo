defaults:
  - model: efficientnet_v2_qat
  - _self_

hydra:
  run:
    dir: outputs/${now:%Y-%m-%d}/${now:%H-%M-%S}

system:
  # audio_data_directory: /home/newbee/prjs/ai/Project-Echo/src/Components/Store/d:\data\b3
  # cache_directory: /home/newbee/prjs/ai/Project-Echo/src/Prototypes/engine/torch_impl/.cache
  audio_data_directory: /home/newbee/Projects/ai/Project-Echo/src/Components/Store/d:\data\b3
  cache_directory: /home/newbee/Projects/ai/Project-Echo/src/Prototypes/engine/torch_impl/.cache
  use_disk_cache: True

data:
  audio_clip_duration: 5 # seconds
  sample_rate: 48000
  n_fft: 2048
  hop_length: 923 # for width of 260 with 5s audio at 48kHz
  n_mels: 260
  fmin: 20
  fmax: 13000
  top_db: 80
  
  train_split: 0.7
  val_split: 0.2
  num_classes: -1 # Should be inferred from data directory at runtime
  
training:
  batch_size: 2
  epochs: 5
  learning_rate: 1e-4
  num_workers: 8
  device: "cuda" # "cuda" or "cpu"
  # device: "cpu"
  seed: 0
  metric_mode: "min"

  criterion:
    _target_: torch.nn.CrossEntropyLoss

  optimizer:
    _target_: torch.optim.AdamW
    lr: ${training.learning_rate}
    weight_decay: 0.01

  scheduler:
    _target_: torch.optim.lr_scheduler.ReduceLROnPlateau
    mode: 'min'
    factor: 0.1
    patience: 10

# Augmentation settings
augmentations:
  audio:
    _target_: audiomentations.Compose
    transforms:
      - _target_: audiomentations.AddGaussianNoise
        min_amplitude: 0.001
        max_amplitude: 0.015
        p: 0.2
      - _target_: audiomentations.TimeStretch
        min_rate: 0.8
        max_rate: 1.25
        p: 0.2
      - _target_: audiomentations.PitchShift
        min_semitones: -4
        max_semitones: 4
        p: 0.2
      - _target_: audiomentations.Shift
        min_shift: -0.5
        max_shift: 0.5
        p: 0.2
  
  image: # Spectrogram augmentations
    _target_: torchvision.transforms.Compose
    transforms:
      - _target_: augment.SpecAugment
        p: 0.5
        freq_mask_param: 30
        time_mask_param: 80
        n_freq_mask: 2
        n_time_mask: 2
