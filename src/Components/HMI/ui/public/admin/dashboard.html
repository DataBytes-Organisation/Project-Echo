<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Echo Admin</title>
    <link rel="shortcut icon" type="image/png" href="/admin/images/logos/project-title.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="/admin/css/styles.min.css" />
    <style>
        .clickable-row {
            cursor: pointer;
        }

        .clickable-row:hover {
            background-color: #f8f9fa;
        }

        .wave-container {
            width: 100%;
            height: 50px;
            overflow: hidden;
            margin-top: -10px;
        }

        .wave-container svg {
            width: 200%;
            height: 100%;
        }

        #breakup {
            height: 100px;
        }
    </style>
</head>

<body>
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
        data-sidebar-position="fixed" data-header-position="fixed">
        <div id="sidebar"></div>

        <div class="body-wrapper">
            <div id="header"></div>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-xl-4 col-md-12">
                        <div class="card mat-stat-card">
                            <div class="card-block">
                                <div class="row align-items-center b-b-default">
                                    <div class="col-sm-6 b-r-default p-b-20 p-t-20">
                                        <div class="row align-items-center justify-content-center text-center">
                                            <div class="col-4 p-r-0">
                                                <i class="fas fa-user-check fa-2x text-primary"></i>
                                            </div>
                                            <div class="col-8 p-l-0">
                                                <h5>10K</h5>
                                                <p class="text-muted m-b-0">Visitors</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 p-b-20 p-t-20">
                                        <div class="row align-items-center text-center">
                                            <div class="col-4 p-r-0">
                                                <i class="fas fa-wifi fa-2x text-primary"></i>
                                            </div>
                                            <div class="col-8 p-l-0">
                                                <h5>600</h5>
                                                <p class="text-muted m-b-0">Network</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row align-items-center">
                                    <div class="col-sm-6 p-b-20 p-t-20 b-r-default">
                                        <div class="row align-items-center text-center">
                                            <div class="col-4 p-r-0">
                                                <i class="fas fa-file fa-2x text-primary"></i>
                                            </div>
                                            <div class="col-8 p-l-0">
                                                <h5>2000+</h5>
                                                <p class="text-muted m-b-0">Files</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 p-b-20 p-t-20">
                                        <div class="row align-items-center text-center">
                                            <div class="col-4 p-r-0">
                                                <i class="fas fa-envelope fa-2x text-primary"></i>
                                            </div>
                                            <div class="col-8 p-l-0">
                                                <h5>120</h5>
                                                <p class="text-muted m-b-0">Enquiries</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-8 d-flex">
                        <div class="card w-100 h-100">
                            <div class="card-body">
                                <h5 class="card-title fw-semibold">Live Event log</h5>
                                </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card  h-100">
                                    <div class="card-body p-4">
                                        <h5 class="card-title mb-3 fw-semibold">Donation Progress</h5>
                                        <div class="row align-items-center">
                                            <div class="col-8">
                                                <h4 class="fw-semibold mb-3">Goal: AUD$1000</h4>
                                                <h4 id="totalDonations">Total Received: $0</h4>
                                                <div class="d-flex align-items-center">
                                                    <div class="me-4">
                                                        <span
                                                            class="round-8 bg-primary rounded-circle me-2 d-inline-block"></span>
                                                        <span>Donations</span>
                                                    </div>
                                                    <div>
                                                        <span
                                                            class="round-8 bg-light-primary rounded-circle me-2 d-inline-block"></span>
                                                        <span>Subscription</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div id="breakup"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 mt-3">
                                <div class="card  h-100">
                                    <div class="card-body d-flex flex-column justify-content-between">
                                        <div>
                                            <h5 class="card-title fw-semibold mb-2">Echo Map Access log - 7 days</h5>
                                        </div>
                                        <div>
                                            <h4 class="fw-semibold mb-3 mt-3">242 visits</h4>
                                            <div class="wave-container">
                                                <svg viewBox="0 0 500 50" preserveAspectRatio="none">
                                                    <path d="M0,25 C100,0 200,50 300,25 C400,0 500,50 600,25" fill="none"
                                                        stroke="#0d6efd" stroke-width="3">
                                                        <animateTransform attributeName="transform" type="translate"
                                                            from="0 0" to="-100 0" dur="2s" repeatCount="indefinite" />
                                                    </path>
                                                </svg>
                                            </div>
                                            <div id="visited"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-lg-12">
                        <div class="card w-100">
                            <div class="card-body">
                                <h5 class="card-title fw-semibold mb-4">Enquiries History</h5>
                                <div class="table-responsive">
                                    <table class="table align-middle">
                                        <thead class="text-dark fs-4">
                                            <tr>
                                                <th>Username</th>
                                                <th>User Detail</th>
                                                <th>Content</th>
                                                <th>Category</th>
                                                <th>Date & Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="enquiry-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="enquiryModal" tabindex="-1" aria-labelledby="enquiryModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="enquiryModalLabel">Enquiry Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <h6>Username:</h6>
                                        <p id="modal-username" class="text-muted"></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Date:</h6>
                                        <p id="modal-date" class="text-muted"></p>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <h6>User Details:</h6>
                                        <p id="modal-userDetail" class="text-muted"></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Category:</h6>
                                        <p id="modal-category" class="text-muted"></p>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <h6>Content:</h6>
                                    <p id="modal-content" class="text-muted"></p>
                                </div>
                                <div class="mb-3">
                                    <h6>Status:</h6>
                                    <select class="form-select" id="modal-status">
                                        <option value="Open">Open</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Completed">Completed</option>
                                        <option value="Closed">Closed</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <h6>Notes:</h6>
                                    <textarea class="form-control" id="modal-notes" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button class="btn btn-primary" id="saveEnquiryBtn">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        let currentEnquiryId = null;

        const mockEnquiries = [
            { id: 1, username: 'john_doe', userDetail: 'John Doe (john@example.com)', email: 'john@example.com', content: 'I have a question about your services...', category: 'Question', date: '2025-04-28', status: 'Open', notes: '' },
            { id: 2, username: 'jane_smith', userDetail: 'Jane Smith (jane@example.com)', email: 'jane@example.com', content: 'I would like to request more info...', category: 'Request', date: '2025-04-27', status: 'In Progress', notes: 'Waiting on materials' },
            { id: 3, username: 'bob_johnson', userDetail: 'Bob Johnson (bob@example.com)', email: 'bob@example.com', content: 'The website was not loading...', category: 'Complaint', date: '2025-04-26', status: 'Completed', notes: 'Fixed issue' }
        ];

        const getCategoryBadgeClass = category => ({
            'Request': 'bg-secondary',
            'Question': 'bg-info',
            'Feedback': 'bg-warning',
            'Complaint': 'bg-danger'
        }[category] || 'bg-primary');

        const getStatusBadgeClass = status => ({
            'Open': 'bg-primary',
            'In Progress': 'bg-info',
            'Completed': 'bg-success',
            'Closed': 'bg-secondary'
        }[status] || 'bg-light text-dark');

        function openEnquiryModal(enquiry) {
            currentEnquiryId = enquiry.id;
            $('#modal-username').text(enquiry.username);
            $('#modal-date').text(enquiry.date);
            $('#modal-userDetail').text(enquiry.userDetail);
            $('#modal-category').text(enquiry.category);
            $('#modal-content').text(enquiry.content);
            $('#modal-status').val(enquiry.status);
            $('#modal-notes').val(enquiry.notes);
            new bootstrap.Modal(document.getElementById('enquiryModal')).show();
        }

        function loadEnquiries() {
            const tbody = document.getElementById('enquiry-table-body');
            tbody.innerHTML = '';
            mockEnquiries.forEach(enquiry => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.innerHTML = `
                    <td>${enquiry.username}</td>
                    <td>${enquiry.userDetail}<br><small>${enquiry.email}</small></td>
                    <td>${enquiry.content.substring(0, 50)}${enquiry.content.length > 50 ? '...' : ''}</td>
                    <td><span class="badge ${getCategoryBadgeClass(enquiry.category)}">${enquiry.category}</span></td>
                    <td>${enquiry.date}<br><span class="badge ${getStatusBadgeClass(enquiry.status)}">${enquiry.status}</span></td>
                    `;
                row.onclick = () => openEnquiryModal(enquiry);
                tbody.appendChild(row);
            });
        }

        function loadDonations() {
            const chart = new ApexCharts(document.querySelector("#breakup"), {
                chart: { type: 'donut', height: 100 },
                series: [750, 250],
                labels: ['Received', 'Remaining'],
                colors: ['#0d6efd', '#e0e0e0'],
                legend: { show: false }
            });
            chart.render();
            document.getElementById('totalDonations').textContent = 'Total Received: $750';
        }

        document.getElementById('saveEnquiryBtn').addEventListener('click', () => {
            const status = document.getElementById('modal-status').value;
            const notes = document.getElementById('modal-notes').value;

            const enquiry = mockEnquiries.find(e => e.id === currentEnquiryId);
            if (enquiry) {
                enquiry.status = status;
                enquiry.notes = notes;
            }

            loadEnquiries();
            bootstrap.Modal.getInstance(document.getElementById('enquiryModal')).hide();
        });

        document.addEventListener('DOMContentLoaded', () => {
            $('#sidebar').load('/admin/component/sidebar-component.html', function () {
                // Fix image paths after the content is loaded
                $('#sidebar img').each(function () {
                    let currentSrc = $(this).attr('src');
                    if (currentSrc && currentSrc.startsWith('./admin/')) {
                        let newSrc = currentSrc.replace('./admin/', '/admin/');
                        $(this).attr('src', newSrc);
                    }
                });
            });
            $('#header').load('/admin/component/header-component.html');
            loadEnquiries();
            loadDonations();
        });
    </script>
</body>

</html>

